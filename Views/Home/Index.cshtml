@model IEnumerable<WebDoDungNhaBep.Models.SanPham>

<partial name="Bannerusers" />

@{
    ViewData["Title"] = "Danh sách sản phẩm";
}

<h2 class="mb-4 text-center text-primary fw-bold">
    @(ViewBag.Keyword != null ? $"Kết quả tìm kiếm cho: \"{ViewBag.Keyword}\"" : "Danh sách sản phẩm")
</h2>

<!-- Nếu không có sản phẩm nào -->
@if (Model == null || !Model.Any())
{
    <div class="alert alert-warning text-center shadow-sm">
        <i class="fa-solid fa-triangle-exclamation"></i> Không tìm thấy sản phẩm phù hợp.
    </div>
}
else
{
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-5 g-4">
        @foreach (var sp in Model)
        {
            <div class="col">
                <div class="card h-100 shadow-sm border-0">
                    @{
                        string imgSrc;
                        if (!string.IsNullOrEmpty(sp.HinhAnh))
                        {
                            if (sp.HinhAnh.StartsWith("http", StringComparison.OrdinalIgnoreCase) ||
                            sp.HinhAnh.StartsWith("//"))
                            {
                                imgSrc = sp.HinhAnh;
                            }
                            else
                            {
                                imgSrc = Url.Content("~/" + sp.HinhAnh.TrimStart('/'));
                            }
                        }
                        else
                        {
                            imgSrc = Url.Content("~/img/no-image.png");
                        }
                    }

                    <img src="@imgSrc"
                         alt="@sp.TenSanPham"
                         class="card-img-top"
                         style="height:180px; object-fit:cover;" />

                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title fw-bold text-truncate">@sp.TenSanPham</h6>
                        <p class="card-text text-muted small flex-grow-1">
                            @sp.MoTa
                        </p>

                        <p class="card-text text-success fw-bold mb-1">
                            @sp.Gia.ToString("N0") đ
                        </p>

                        <p class="card-text text-secondary small">
                            <i class="fa-solid fa-tag"></i> @sp.MaDanhMucNavigation?.TenDanhMuc
                        </p>

                        <div class="mt-auto d-flex justify-content-between align-items-center">
                            <!-- Thêm vào giỏ -->
                            <form asp-action="ThemVaoGio" asp-controller="GioHang" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="maSanPham" value="@sp.MaSanPham" />
                                <input type="hidden" name="soLuong" value="1" />
                                <button type="submit" class="btn btn-sm btn-outline-warning" title="Thêm vào giỏ">
                                    <i class="fa-solid fa-cart-shopping"></i>
                                </button>
                            </form>

                            <!-- Xem chi tiết -->
                            <a asp-action="ChiTiet" asp-controller="Home" asp-route-id="@sp.MaSanPham"
                               class="btn btn-sm btn-outline-primary me-1" title="Xem chi tiết">
                                <i class="fa-solid fa-eye"></i>
                            </a>

                            <!-- Mua ngay -->
                            <form asp-action="MuaNgay" asp-controller="DonHang" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="maSanPham" value="@sp.MaSanPham" />
                                <input type="hidden" name="soLuong" value="1" />
                                <button type="submit" class="btn btn-sm btn-outline-success" title="Mua ngay">
                                    <i class="fa-solid fa-credit-card"></i> Mua ngay
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}
